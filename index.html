<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>쏘카 미디어리스트</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0f1117;--surface:#1a1d27;--surface2:#22263a;--border:#2e3350;
  --accent:#4f8eff;--accent2:#ff6b6b;--accent3:#63e6be;
  --text:#e8ecf4;--text2:#8b92a8;--text3:#545b73;
  --active-bg:#162340;--inactive-bg:#1c1822;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Pretendard',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:14px;}

/* HEADER */
.header{display:flex;align-items:center;justify-content:space-between;padding:14px 28px;border-bottom:1px solid var(--border);background:var(--surface);position:sticky;top:0;z-index:100;}
.header-left{display:flex;align-items:center;gap:12px;}
.logo-img{height:36px;object-fit:contain;display:block;}
.logo-label{font-size:15px;font-weight:700;color:#fff;letter-spacing:2px;height:36px;line-height:36px;}
.header-count{font-size:12px;color:var(--text2);background:var(--surface2);border:1px solid var(--border);padding:3px 10px;border-radius:20px;}
.header-count span{color:var(--accent);font-weight:600;}

/* TOOLBAR */
.toolbar{display:flex;align-items:center;gap:8px;padding:12px 28px;background:var(--surface);border-bottom:1px solid var(--border);flex-wrap:wrap;}
.search-wrap{position:relative;flex:1;min-width:220px;max-width:360px;}
.search-wrap svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--text3);pointer-events:none;}
.search-input{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:8px 12px 8px 32px;color:var(--text);font-family:inherit;font-size:13px;outline:none;transition:border-color .15s;}
.search-input:focus{border-color:var(--accent);}
.search-input::placeholder{color:var(--text3);}
.filter-group{display:flex;gap:5px;flex-wrap:wrap;}
.filter-btn{padding:6px 13px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text2);font-family:inherit;font-size:12px;cursor:pointer;transition:all .15s;white-space:nowrap;}
.filter-btn:hover{border-color:var(--accent);color:var(--accent);}
.filter-btn.active{background:rgba(79,142,255,0.15);border-color:var(--accent);color:var(--accent);}
.separator{width:1px;height:24px;background:var(--border);flex-shrink:0;}
.status-btn{padding:6px 13px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text2);font-family:inherit;font-size:12px;cursor:pointer;transition:all .15s;white-space:nowrap;}
.status-btn.active-filter{background:rgba(99,230,190,0.12);border-color:var(--accent3);color:var(--accent3);}
.status-btn.inactive-filter{background:rgba(255,107,107,0.12);border-color:var(--accent2);color:var(--accent2);}
.add-btn{margin-left:auto;padding:8px 16px;background:var(--accent);border:none;border-radius:8px;color:#fff;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:opacity .15s;display:flex;align-items:center;gap:5px;white-space:nowrap;}
.add-btn:hover{opacity:.85;}
.refresh-btn{margin-left:8px;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text2);cursor:pointer;display:flex;align-items:center;gap:5px;transition:all .15s;}
.refresh-btn:hover{border-color:var(--accent);color:var(--accent);}

/* MAIN */
.main{padding:18px 28px;}

/* MEDIA GROUP */
.media-group{margin-bottom:18px;}
.media-header{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px 8px 0 0;cursor:pointer;user-select:none;}
.media-type-tag{font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px;letter-spacing:.5px;flex-shrink:0;}
.tag-종합지{background:rgba(79,142,255,0.15);color:#7ab3ff;border:1px solid rgba(79,142,255,0.3);}
.tag-경제지{background:rgba(99,230,190,0.12);color:#63e6be;border:1px solid rgba(99,230,190,0.25);}
.tag-인터넷{background:rgba(255,200,60,0.12);color:#ffc83c;border:1px solid rgba(255,200,60,0.25);}
.tag-통신사{background:rgba(180,100,255,0.12);color:#c478ff;border:1px solid rgba(180,100,255,0.25);}
.tag-IT\/스타트업,.tag-IT스타트업{background:rgba(255,170,50,0.12);color:#ffaa32;border:1px solid rgba(255,170,50,0.25);}
.tag-방송{background:rgba(255,100,150,0.12);color:#ff6496;border:1px solid rgba(255,100,150,0.25);}
.tag-주간지\/월간지,.tag-IT스타트업{background:rgba(20,184,166,0.12);color:#14b8a6;border:1px solid rgba(20,184,166,0.28);}
.tag-기타{background:rgba(150,150,180,0.12);color:#a0a0c0;border:1px solid rgba(150,150,180,0.25);}
.media-name{font-size:14px;font-weight:600;}
.media-count{font-size:11px;color:var(--text3);margin-left:auto;}
.chevron{color:var(--text3);font-size:11px;transition:transform .2s;flex-shrink:0;}
.chevron.open{transform:rotate(180deg);}

/* TABLE */
.table-wrap{border:1px solid var(--border);border-top:none;border-radius:0 0 8px 8px;overflow:hidden;}
.table-wrap.collapsed{display:none;}
table{width:100%;border-collapse:collapse;table-layout:fixed;}
thead th{padding:8px 10px;background:rgba(15,17,23,.95);font-size:11px;font-weight:600;color:var(--text3);text-align:left;letter-spacing:.4px;border-bottom:1px solid var(--border);white-space:nowrap;overflow:hidden;}
tbody tr{border-bottom:1px solid rgba(46,51,80,.4);transition:background .1s;}
tbody tr:last-child{border-bottom:none;}
tbody tr:hover{background:rgba(79,142,255,.04);}
tbody tr.row-inactive{opacity:.6;}
tbody tr.row-inactive:hover{opacity:.8;}
td{padding:9px 10px;font-size:13px;color:var(--text);vertical-align:middle;overflow:hidden;}
td.td-dept{color:var(--text2);font-size:12px;}
td.td-name{font-weight:600;}

/* COL WIDTHS */
.col-dept{width:130px;}
.col-name{width:120px;}
.col-email{width:160px;min-width:100px;max-width:160px;}
.col-phone{width:130px;}
.col-send{width:90px;}
.col-history{width:150px;}
.col-memo{width:160px;}
.col-status{width:80px;}
.col-actions{width:70px;}

/* EMAIL TAGS */
.email-cell{display:flex;flex-direction:column;gap:3px;}
.email-tag{display:inline-flex;align-items:center;gap:4px;background:var(--surface2);border:1px solid var(--border);border-radius:5px;padding:2px 8px;font-family:'DM Mono',monospace;font-size:11px;color:var(--text2);cursor:pointer;transition:all .12s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:170px;display:block;}
.email-tag:hover{border-color:var(--accent);color:var(--accent);background:rgba(79,142,255,.08);}
.email-tag.copied{border-color:var(--accent3);color:var(--accent3);}

/* PHONE */
.phone-tag{display:inline-flex;align-items:center;font-family:'DM Mono',monospace;font-size:12px;color:var(--text2);cursor:pointer;padding:2px 6px;border-radius:5px;border:1px solid transparent;transition:all .12s;white-space:nowrap;}
.phone-tag:hover{border-color:var(--accent);color:var(--accent);}
.phone-tag.copied{border-color:var(--accent3);color:var(--accent3);}

/* SEND FLAGS */
.send-flags{display:flex;flex-direction:column;gap:4px;}
.send-flag{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:500;padding:2px 7px;border-radius:4px;}
.flag-email-on{background:rgba(79,142,255,.12);color:var(--accent);border:1px solid rgba(79,142,255,.25);}
.flag-sms-on{background:rgba(99,230,190,.1);color:var(--accent3);border:1px solid rgba(99,230,190,.2);}

/* HISTORY PILLS */
.hist-pill{display:inline-flex;align-items:center;gap:3px;font-size:10px;font-family:'DM Mono',monospace;padding:2px 6px;border-radius:4px;}
.hist-join{background:rgba(99,230,190,.08);color:var(--accent3);border:1px solid rgba(99,230,190,.15);}
.hist-leave{background:rgba(255,107,107,.08);color:var(--accent2);border:1px solid rgba(255,107,107,.15);}
.hist-wrap{display:flex;flex-wrap:wrap;gap:3px;align-items:center;}

/* STATUS */
.status-badge{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:600;padding:3px 9px;border-radius:12px;cursor:pointer;transition:all .15s;border:1px solid transparent;white-space:nowrap;}
.badge-active{background:rgba(99,230,190,.1);color:var(--accent3);border-color:rgba(99,230,190,.2);}
.badge-inactive{background:rgba(255,107,107,.1);color:var(--accent2);border-color:rgba(255,107,107,.2);}
.status-badge:hover{opacity:.75;}

/* ICON BTNS */
.row-actions{display:flex;gap:3px;}
.icon-btn{width:26px;height:26px;display:flex;align-items:center;justify-content:center;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text3);cursor:pointer;transition:all .12s;font-size:12px;}
.icon-btn:hover{border-color:var(--accent);color:var(--accent);background:rgba(79,142,255,.08);}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px);}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:26px;width:560px;max-width:96vw;max-height:92vh;overflow-y:auto;}
.modal-title{font-size:16px;font-weight:700;margin-bottom:20px;}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:13px;}
.form-field{display:flex;flex-direction:column;gap:5px;}
.form-field.full{grid-column:1/-1;}
.form-label{font-size:11px;font-weight:600;color:var(--text3);letter-spacing:.5px;}
.form-input,.form-select,.form-textarea{background:var(--bg);border:1px solid var(--border);border-radius:7px;padding:8px 11px;color:var(--text);font-family:inherit;font-size:13px;outline:none;transition:border-color .15s;}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--accent);}
.form-textarea{resize:vertical;min-height:68px;}
.form-select option{background:var(--surface2);}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px;}
.btn-cancel{padding:8px 18px;background:transparent;border:1px solid var(--border);border-radius:8px;color:var(--text2);font-family:inherit;font-size:13px;cursor:pointer;}
.btn-cancel:hover{border-color:var(--text2);}
.btn-save{padding:8px 20px;background:var(--accent);border:none;border-radius:8px;color:#fff;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;}
.btn-save:hover{opacity:.85;}

/* EMAIL LIST IN FORM */
.email-list{display:flex;flex-direction:column;gap:6px;}
.email-row{display:flex;gap:6px;align-items:center;}
.email-row .form-input{flex:1;}
.btn-remove-email{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text3);cursor:pointer;font-size:14px;flex-shrink:0;}
.btn-remove-email:hover{border-color:var(--accent2);color:var(--accent2);}
.btn-add-email{padding:5px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-family:inherit;font-size:12px;cursor:pointer;margin-top:2px;width:fit-content;}
.btn-add-email:hover{border-color:var(--accent);color:var(--accent);}

/* SEND TOGGLE BUTTONS */
.send-toggle-row{display:flex;gap:8px;}
.send-toggle{display:flex;align-items:center;gap:6px;padding:7px 14px;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--text2);font-family:inherit;font-size:13px;font-weight:500;cursor:pointer;transition:all .15s;user-select:none;}
.send-toggle:hover{border-color:var(--text3);}
.send-toggle.on-email{background:rgba(79,142,255,.12);border-color:var(--accent);color:var(--accent);}
.send-toggle.on-sms{background:rgba(99,230,190,.1);border-color:var(--accent3);color:var(--accent3);}
.send-toggle .dot{width:7px;height:7px;border-radius:50%;background:currentColor;opacity:.5;transition:opacity .15s;}
.send-toggle.on-email .dot,.send-toggle.on-sms .dot{opacity:1;}

/* HISTORY MODAL */
.hist-modal-entries{display:flex;flex-direction:column;gap:7px;margin:14px 0;}
.hist-modal-entry{display:flex;align-items:center;gap:9px;padding:9px 12px;background:var(--bg);border-radius:8px;border:1px solid var(--border);}
.hist-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.dot-join{background:var(--accent3);}
.dot-leave{background:var(--accent2);}
.hist-date{font-family:'DM Mono',monospace;font-size:12px;color:var(--text2);min-width:90px;}
.hist-type-label{font-size:11px;font-weight:700;}
.type-join{color:var(--accent3);}
.type-leave{color:var(--accent2);}
.hist-note{font-size:12px;color:var(--text3);flex:1;}
.add-hist-row{display:flex;gap:7px;align-items:center;margin-top:4px;}
.add-hist-row input,.add-hist-row select{background:var(--bg);border:1px solid var(--border);border-radius:7px;padding:7px 10px;color:var(--text);font-family:inherit;font-size:12px;outline:none;}
.add-hist-row input:focus,.add-hist-row select:focus{border-color:var(--accent);}
.btn-add-hist{padding:7px 13px;background:var(--surface2);border:1px solid var(--border);border-radius:7px;color:var(--text2);font-family:inherit;font-size:12px;cursor:pointer;white-space:nowrap;}
.btn-add-hist:hover{border-color:var(--accent);color:var(--accent);}

/* TOAST */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(10px);background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 20px;font-size:13px;z-index:9999;opacity:0;transition:all .2s;pointer-events:none;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.no-results{text-align:center;padding:60px;color:var(--text3);}

/* LOADING OVERLAY */
.loading-overlay{position:fixed;inset:0;background:rgba(15,17,23,.85);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:99999;backdrop-filter:blur(3px);}
.spinner{border:4px solid rgba(79,142,255,.2);border-top:4px solid var(--accent);border-radius:50%;width:36px;height:36px;animation:spin 1s linear infinite;margin-bottom:14px;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
#loadingText{color:var(--text);font-size:14px;font-weight:500;letter-spacing:0.5px;}

/* COPY ROW BTN */
.copy-row-btn{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:5px;border:1px solid var(--border);background:transparent;color:var(--text3);font-size:11px;cursor:pointer;transition:all .12s;}
.copy-row-btn:hover{border-color:var(--accent3);color:var(--accent3);}
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <img class="logo-img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKUAAAAkCAYAAADox/qnAAABCGlDQ1BJQ0MgUHJvZmlsZQAAeJxjYGA8wQAELAYMDLl5JUVB7k4KEZFRCuwPGBiBEAwSk4sLGHADoKpv1yBqL+viUYcLcKakFicD6Q9ArFIEtBxopAiQLZIOYWuA2EkQtg2IXV5SUAJkB4DYRSFBzkB2CpCtkY7ETkJiJxcUgdT3ANk2uTmlyQh3M/Ck5oUGA2kOIJZhKGYIYnBncAL5H6IkfxEDg8VXBgbmCQixpJkMDNtbGRgkbiHEVBYwMPC3MDBsO48QQ4RJQWJRIliIBYiZ0tIYGD4tZ2DgjWRgEL7AwMAVDQsIHG5TALvNnSEfCNMZchhSgSKeDHkMyQx6QJYRgwGDIYMZAKbWPz9HbOBQAAAeeElEQVR42u18e3hW1Znv+6619t7fLeRCSEKQOyZgAAWK07FODRbvVmtrOHbaM+rTqp0zRQ9a6bSOJtHOacFaaTs9baztVHuZI7F4qQXK1CbxMioGuQiYgCEBQq7ky3e/7G/v9c4fWTtsPpPwBan/HPfzrOfbkLXXu9+1fuu9r40wqYvYihVP8P3zrnvO8pVfRxZKAGA5PixBABPJ/tem92+74mjLbWkABAAg+Pj6+HJdLOeetcQAUB6avXSO9E2/jgECF8S4AOCCcmiADAHIyP+bgfzziwCQPsbjx9eHA+XBEbEmxZTZQmfEOdicI3AOMPJ7hsYAhADQIBMvjO9O/7UYIiKsra1lROQ0PMckkIjQGV/Rwr/iGv3V6GWPC0p1/bUvRRfH4yN3UF4ACEDIjPwLmQHIGBDjAJNoxDQAFNB/x8trh0f4x3PJpCAihohUX18vEdFphIhARJyI+FkSRdfzpMaUiCgVLSIi1tTUJM4FYBQ/Z6SneJ4UPQVqQUSYPe4I6ZF5HGNuT2sKxO535tl9mpqahHsO1fwwRZfG40NMgh8JgMTE4JXIAEhInAymASShzgAzdkc9gIQayaER7XOwgBwRbQCwAAAaGhp8FRUVJQsWLNAGBwehr68vdO211w6qPoCIIKV0nsl5fFd/1tTUVFJYWDhF13U4ceJE6rHHHutHxPTIHJ32Th+GH+d5vm3btpLp06fn5eXlQVdXV/rpp5/uR8SUmx4ASESkXMZWAITt27cX5efnTz3vvPPgwIEDqauvvroHEa0svsmZ2wl37QT8Ohtg1apVFgDAo48+6l+wYIHW0NCQzJo3hohS5Li9GNQjzbxlR3nU4/s7IADGGZvcbDNCAQSQ2n1K8n44aeJMxo4dO8qXLl26xu/3XyOEqELEaZxzUVJSAlVVVZF4PH48FovtTCQSz86dO/dPiGgraUATLaQLIOzIkSPXFxYWfl7X9b8RQswAAD8iwrx588xLLrmk3zTNfdFo9MVdu3Y9i4gh1/vRZPlZt26dd+3atTcUFhbeaBjGcsbYDET0ISKUl5dnPvWpT/U9/vjjBxOJxEttbW2/R8R+96JONHZra+usWbNm/U+fz3ct53whYywfEXHatGnpeDx+zDTNHYODgz9DxINEhG+88Ub5okWLvsgYIyklAoBkjLGjR4/uWLp06T6HZldX15cLCwvLLMsiAADGGEaj0aFf/OIXT6l34j09PV/Jz8//H5zzhYioX3nllXHbtt+LxWLP//a3v/0NIsbVBsvJyREAAKV3HP9W8XqiorspM/Ueokm1u8kuvpeo5Pb21QAAUJMr8XF3HgAAnjhx4lvxeDxIOV6xWGxnZ2fn5xypOZb6c9s7hw8fviEaje7KdfxkMnm8r6/vHsdMcKvCCfgZ7dPd3X1bLBY7lCu9VCo10NvbW1dbW+txSc0PABIAsKen51/S6fTwmcZMp9Op3t7ebyr+q8fqc+zYsa+r8TUAgOHh4fbsPsFgcBAA4M9//vOMcDj86kQ04/F4++HDh6tztCkJAUBWXrIhDzz5a5GAOAc2KXuSSWIGMMwk+in2n28CAEAjyA8hIfGZZ57Rh4eHny8vL/8/Pp+vUKkYGwCklFKqe/e/LQCQfr9/5Zw5c54bHBz85fLlyzVl1+AYUgUHBwd/uGDBghcCgcByNZalVA1lNYee5fF4zistLd0UiUR2tLS0TEdEOREwHUmzZcuWqUNDQy/MmDHj3/1+//kAYEsp7TPRMwxjWllZWe369etf37Nnz2JEtB17z+HlySefzAuFQi9Nnz79EV3XCwDAUnMy1riWrut6WVnZ9/r7+9f29/f3Kr5N9ZsCAItznsxS30H197SU0gQAizHWW1tbO2XlypV/mjJlyqUAkFF8fYAPn89XMWvWrO3d01OUvJ6f/Y+XD5Q0Rl95NVtp5oUu1+ypQ/RFS+tucJ95hnCUoGAHDy5MnfORubiKS6t1z37suybdsmIlK/FhFRNBp945VXXpnm9gaVpOFDQ0Nb1LMZ51k1tkVEGfVrq/uMQ9e2bUlEptr9bbt3754xnsR0/u+NN94ojcfjex16alznctPIuGhL1zuZSkoPHTp06Aq3o1RbW6uHQqFm1dd0z4/iy82L5eLXMk0zc+DAgW9blmW63idDRHT8+PE73JIyHA7vzJ7rgYGBtzs7O59wrZPl5kPNlfMuJhHR8PBw38TgqNnMoR6tsttfuYDnT78fLLAZBzZJGAEAMshkiMe7fzoSXmqkD+MEDAwMXDN16tQvqp2nuwhxAIBUKnU8k8mENU1jiDjTMIw8NmIC24wxLqW0GGMgpdRs2yalagkAGCLaJ0+e/GlRUdFNAGASka6edRIFfIIIhs0Y4wCgAUDG5/NVLliw4A8NDQ2XAkDaMfjdEr+hocFXVVW11efzLVX8aC5+pKI33pzb6u+alDLt8XiKiouLa+vq6l6uq6tDRLROnjz5o/z8/MuUpNMVbUBE510/MLYzV5qmifnz5z/s2Eo5xxnVAPn5+UsKCwtXqPfUsiMfDh0pJTDGtHg8fqKnp+ezYkK1XQMAjSD0aYt/hT7DQymwgU/SQSG0mBcEBYf/cPSXF++GGvowXjcBAHg8nnsAgKSUzA2YSCTSPDw8/EBjY+Pe+++/Pw4A2NLSUrZo0aJP+3y+b/j9/k8AgMkY00Oh0GubNm26qr6+PqEAwhDR7urq+sLUqVO/BgAZItLVekgAYLZtQyKR2JpOp/8Yi8WOZDIZ6fP5Zni93lWBQOBzuq7nuYECAJlAILDsxhtv/B4i3q2k8KgXj4h2f3//43l5ecuzADm6ARKJREc6nX4FADo8Hk8ylUrN8Hg8y4QQl2qapqm+kjFmRCKRA52dnWvq6uoQAOy2trZLi4qK/pdSq5oLkKTG3hOPx59NJpP74vF4uqioqETTtNWBQOBmXdf9AGAbhnHWtr+u64ZbWCQSiddN03xHCBGWUs7Xdf1yj8dTyhiDZDLZf/jw4auWLVt2YFwPf0XDiFief1/3z+Z/l2jOg2TNrSWa+1Dubc5DtpxTR3Lug0l73p3/tQTuJA3WHjKglsSE7TL1W7OZZ9t6GzZsyEskEgMuVWkTkYzH4+3r1q3zumycbJ7E8ePHHyUiCoVCrz355JN5LhWKRIQvvviiLx6PdxGRdKlsW6niw0eOHLlsvAl77bXX5kcikZdcZsSoujdN037nnXcuVI4VUxIfDh48+ElFJiOlJBdPlEqlhnp7e7/iODDZ16FDhy4Ih8P/z1F/0Wj0wPPPP1+ueBIAAKFQqGmM97EzmQz19/ffP4bUBwCAPXv2VITD4Veyns1ZfWeZHjKdTvd3dnZek01ny5YtU4PB4M/i8XjP7t27q9zv/oHrMmXzVXzj+D9XbiCa/7CdWVAvaX69pAU5tvn1kubV21blRsta9K22r3yI4A+6Qdna2jo9nU7HXJOcISIaGhp6WvXzOUFax05samoSDkg7Ozu/uHXr1mlum86ZiN7e3tvdE+9MaiKR6Ny6det5Tl/VOBFxRWt0IqPR6LNZi5NR9tWvXUFmrkDzwjj0+nbu3LnYFSHIDl6PqtyhoaH64eHhtt/97nflbpC0tbUtzWQyMss+tYiIjh49+jWH//F4ufPOO33hcPhtl+05KVCqTWabpmkdOHDg01lzd9qcbd68+bT1EGMBsqUerfPvPfANXnred20LLMEYB6TJ2n/EDcZDh/tiJ9sjiwI3Hd6IZHpEoCACSExqhkXphI/Ql7IkG/EFT4XpCXQJYri7Kf5HbHaACQBw5MiRRFVVVRoA/DDiWnPGGPn9/tW7d+++CBH3ZElXXl1dTQ899BCrq6sDRPwPV1hJutQlBAKB2xwjeNRos206fvz4rddee203EWmImBnP3gUA+fzzz3/1mmuuucQwjDLl+XPGGOTl5V2/ffv2IuWlQmtr6yyfz3eVW70BAFiWBceOHfv7iy++eL8yHzJOQHssJwkRa2tqah5tbGyMObFXAIDi4uKbhBCozAUmpbQZYzwUCr0we/bsnykwWeOMLRAxcdddd/3DkiVLdmuapmfPSw7BdAsARDQafbaqquoVxYs5Tvx00B1jPQ2UlzWRaFmFVuV9e+/Xzrtgo22CzRE4CMBJZeeIgBsMT74fg4GjPKCXr7wPDADUAaQAIK5iEF4AywawLQCiD7oPUnq/nXfVy4ujf2LtWCeZAlI4Go3uB4BLpZSkjHUyDGP6BRdc8F+RSOSZUCj04uDg4FuI2OPORtTV1QkFHsvtcCCifOutt8p0Xf+EmvjRRYxGo3+qrKx8RS1UZqKMRmtrq3bTTTeFgsHgjwzD+K5yfAQASI/HU1BVVfVJANgKAFBSUrJa0zRDvZ9w6EUikRcWLlz4F7UBzAnoSdf7xxw+SE2kruufdro6wWzLsqizs/NfFRjGzQAhoqX4fS8YDD5XWFh4i/Oek0nNKgn6ayJizc3Ncgw6NIaAOOV5rWggrWUVWlXfOnSPZ/bSjSDB4giMc8CRoovcGmMAug9h6EgMBt6Pg5EnQPCYxTFpIZkW2JYFpm1BWloyBZZMgYUWWMx2NUtazIIU9/sFeAuKAAjgYONosjwYDD6mnDypYl4IAKTrujcvL++2mTNnblm8eHFbPB5/LRgMPnrs2LGrN2/eHEBESwHLXXzAAADKy8sv0HXdp6QmMsYIACCZTP421/zyihUrbCLCnp6eFy3LkgDAFUik2jifcPr6fL5PkGsnKocNYrHYL4kIm5ubKUeJRI5X7yxubW2truv6Ahc4JAAw0zTbli9fvutMaUG3JIvH441ukOWoJQEAuGmaZjAY3IOIsrq62p6Ihw+EMy5rIrHrLswsfbD9buO88zeRBIsBcCYAJxckBzB8AIMdUeg/FAcj3wDh1UDoTDCNCxRMIOeCMSYIURCQ4ByyGgnGGQkfeESi+yfR51e8CbXEoHGN7aQHZ8+e/eLQ0NAPAEBjjKFLGjp5WlvX9Tyfz/epwsLCb8ycOXPbDTfccGBoaOiH+/btW+jkdJ2wjALFvNEkvZpUKSVEIpG9iEiNjWcOYzHGJCLS22+/fcS27R7lQDnPoa7rs1ye6WyVh3fCUTyTyZjBYHAfItJYkiXXRb388sunMsaKskAJtm3vc3n2ZyxWQESKRqP7bdu2XRssJ9NNmVb9Tz31VP+kS9cclb287r17jBkVPyQ5orKFBijESLlZLo1zAMMPMNgRg762BHjyDdC8AoTOgRkMUGfABANkAIQjWOAcYaQeUzVOwARmtABoWrTnZ7Hfzvw61BJC/alJV2DixcXF9w0MDPyzaZoppVZQ2XAIAKgk6GgWxjCMWUVFRXdXVFTs7uvr2+BkcxxQ+v1+b9Yio5QybhjGAABATU2NzEVCICLcfvvtqXQ6HXWHsQAAvF7vFBeNAkdCOga1bdvRPXv2hJSpcTaxXMcpDEgpvdl/TKVSQ5OQeqS8/JhpmunJ5PEdLWNZVuLHP/6xiYgwmVAna1mF1kX/svcebcbCTdIGmwEwxgGRAeTaAAF0L0D/oSicOBAHrwNIgwE3GDAhgHEGI0JtxH5k7JR0HW0CM5ofNB7taQg/PeMfoYY41I+mwE6540pilpaWbjh8+PCKkydPPp1KpSIAwJ2AsJKgDugckFqGYXhKS0vXNzU1vdTQ0OD7KItX3Yua6wKfy0tt2I+CDgAAZDKZs6LHlj607z79vMWbrAzYIIEBTi44TgSgGQC9bTHo3p8Eb4EBmk+A8HDgOgeuceAKkAQIgFnSUUlZJiCj+UFjkd4nQv8+42sjQfaRcrnxDH0i4osXLz44bdq0W998882qnp6eO4aHh3+fTCa71MQI5dk6NqJQQDXz8vKuvPnmm3/iOC/RaDSV5RUSY8wvpSwBAGhsbMylsAKJCB577DGvYRhTsqVSIpGIuhYu5CygY08KIfIuuuiiAiUpz2ZBSc1NTJW2nXb5fL6p2dL7TFJ3yZIlARUEh79yMfMpUBolVd+3bZYBGyQh2ARg5dQILJJAI4CMQveBOPgKddB9HISHgzA4cF0AEwjIR8Q3wxEVnd2YgIweAE1E+p4IPll+F2yeGJBuj9cJRq9atap7xowZTxYVFd28YcOGRe+///6ygYGBf4pGoy+ZpmkqO4qUnacDgFVYWHjb/v37L1ZjHXFlWpyUIQQCgQuJCGtqanJZECQivPHGG+dzzssVsJ3nyDTNLleoqZOIHFWHAGALIfT8/PwLiQirq6tZ7oLhdLD85S9/GSKiIRcAmQL9hTU1NdyxMc+EDSJCr9e7hHPOAcCeZLbx7EEp05EBLQCa8IOm+UHk3AIgdD9gb1sEug8kwVdgjADSOyIlmcaACQDkDJCP1AMzDsAEjjYuEBhHSw+AJkJ9P+9vmH4X1BCHNWcGpAIAd8BZW1vrVH7z+vr6VGVl5Z7S0tL/O2XKlM++9957K+Lx+E6XAT+qQktLSz8LAHDs2LE20zTjbvAqO/DLuaraXbt2cUSk/Pz8m10xQsehxFQq1er0jcVibzvld26VN3Xq1FsRkaqrqzFXQGZ54Ky+vt40TfNwFiilYRiV9fX1K8cqcRvP3PD7/TWTkK7n5BKyf281actvBuEXZFs5VJNLkDYwzcdTx97pu7X/eGCBr0BI3S/YKZXNABkDwBGVLWlERY+h+i3uA0HB3idP/LT8TticOyBVOb09VkW1y6tmqu/+PXv2fG3x4sWtnHN0HBLVpxIA4JJLLjkRj8ff1HX9cjmSVOcAIH0+3xWdnZ2rELFpouB5U1OTWLlyZaapqak4Ly/vn1RunitpyZLJ5PCrr776ltP/5MmTL5eWliY1TfOoPg69z7W1tX0GEV8eK+A8RvBcAoBQsUXmANA0zRYA+IwLTMQYg7KysocQ8VqlYcaMVba2tmqImGltbV3i8/k+5yoM+WhAuXtj9XsA8MiknyxvXCYuvPx+bwFK3auh8HLgOhsBpGCAyEZmQxLwMcQ+EVjMD4LCg7/p/lH5HbkC0pUFgGPHjv0gHA4/hYh7VdqKXJJQEhE1NzdzItKam5sHbduWnHPhXgjbtrkLKL+eNWvWZxzvEQCAcw5lZWVPvf7663+HiEdd53wIAKC5uRmrq6udDAZfvnz5rw3DKHZVDFkAIEzT/P2XvvSlYZd0PxEMBrcVFhZ+3h2YFkLA3Llzn25vb1+NiO85WakP5F7Vhuzu7n6goKDgc0eOHLkSEUfHP3r06Av5+fn1QgimNiEHALuwsPCa3t7eryPivzmmzxi8ZB599FF/ZWXlU0IIQ21S/MhACbXELsvxsE2sHDDZA3hiz/O+jL38Ra0wf4qmxaTwaSgMpbI5B+SnnCAayw4hsJkXBIUH35z9WMntx0d2+GQASb29vb8pKyv7UklJyd93dHTcgYh/yBKl4D5f0t/ff4uu68JVxQMq4H7ESa396le/embNmjUP+ny+efJUCZL0eDwzL7roopaurq6vIOLLY73bzp07KxcuXPhveXl5q100CADQsiyru7v7cbVZqLGxERERurq6vpeXl3eTEGJUzUopSdf18lmzZr3W09Ozrrq6+nctLS0fSAXu27dv3owZM2qLior+AQCgoqJix/79+69CxKDKxuwLBoPNhYWFqxSAnTI1u6Sk5Mf9/f15iPh9VZ102vXuu+8umjNnzi8CgcAy1+b66KIUk+p9WZOAllVW4Lp3v82LF/+rpoUt3auLUzakAiQhjBtnJZCoA5CZGMb2Hcs6nvn8caiVDOrxTMY3OhmL3t7eX5eVlX3ZXSM4NDS0ORwOP3nkyJF3rrjiiiAA0K233uq59957Z5eWlt5WXFz8DWWwO3zbAMA7Ozuvmjdv3o5Dhw4ZFRUV6fb29psqKiq2qNI1zV26RkSQTCa3xWKxbaZpdjDGLMbYeR6P53Kv1/t5wzC8WaDPAIA2MDDwg9LS0vvcB8qc+8HBwR8VFxevHad0DZLJ5MFEItFsmub7tm3bPp+vWNf1FbquVzsZKLWBRCqVevvo0aPXVlZWhgDAbm9vv6SiouI1R4qrORyNwyYSif3JZHJzKpXai4gpIpru9/s/4/V6awzD8GTxMpqeBwDR3d1958yZM3/umDThcHjnlClTVqr6SGSMseHh4UNFRUULXYmKc22XEgIQFq5uyC+4pad/2tfScsbdMTl7fZrmPZihBfU2nf8dSRXfkXT+IzROk7TgEbIWbiSa/78PrBkpAGnKKZ/qqKUTJ0485RxPcZV6SdeZlaFEInEwEom8m0qlOlOplDVGJXpGlbDtufPOOzVXtRAHABgYGPiJUy3tlJQ5FTxnON7ipmUSEUUikdZ169Z5VSUOZoWPeG1trScSibzlfsZdZpYrPdu2U0RE4XC42TlGCwAwODj4I1fl93jvOu7YyWTSsizLPpvK82Aw2K5s+kkJwEl8IQM4ABIv/vQXPMVlJYYnI3WfhpqHgdAZCA1V7hsnSEOSrQeAU2xoa8emqs0jFUmrrFx3BREhY+yPmUwmAQCGU0GuFttWHmaR1+tdlJeXt9gwjDmqSNV2dqmU0rHxUsPDw7c/8cQTbvUliYiXlJSsDQaDvwcAHRFtdZ6FueiMngdS95ar2kc6Ui8ej7ft27fvhk2bNiUh6+SkuqeHH344tXPnzhui0eheJSmdc0COo+amYblok8tEsBhjRjqdDsfj8e+pbBAREX/ggQfuC4fDTUqjZFzSirvGPo0XxS9kMhmro6PjQVcU4aMJCU0mUA8AoAWmfNnwI+leDsLDQBgKkOJU2nDMVCQH4BowljEznlT/eiDClkkci1BeJk6fPn1zZ2fn1YlEokNV4KC7/Mp9aEzdO2aBrTxQkU6nQ319fTfOnTt39+bNm7lToaKAIomIpk6devPJkyc3qSwRUw6UpcDCXUUd3AUeW91rkUjkP5ubm1ddeumlPVLKMY++IqKUUrLVq1f3b9++/fJwOLxFOTwMTh0ccwDkbugCEQKASCQSe9rb2y8vLy/frubEBgDZ0NBgPfvsszcODw9vhVNHEhwgZvPCnIoiAODDw8P3hkKhLZxzhFMHxyy1CWSWxLCzN89YZXHnDpQj577lzFt2lGt+/yeFbqPwciY8DISu4o0MJmzIwdIDDDEdeWnvxqoDNY3AoHHNpHagk8WprKx8tampaeXg4OCj6XR6yJW5YQpA3AUm598ik8lgLBb7fUdHx8WzZ8/eQUR8zZrT38FdTjVt2rR1XV1d10Wj0V1qHOFaQHcbpWma5tG+vr578vPzr7z++uv7xjuLncUTW7NmTbCgoOALvb29tyaTyTZ3ynQCeiKVSg0MDw8/uHHjxr+98MIL31G2qnuTwVe/+tVoUVHRdcFg8JvpdDrkznSNMa5Ip9PmwMDA+tLS0h+XlpZOV/119esBAGHbtjcLlEXq7wZjTFfleMVn533nclXVIUA9eItmrcSp+V5kts11zgVHAIaQS6CfAJARgJ0c+Lm7aPcs8sf25s2b+fXXXz8MAOu3bdv2+LJlyz7r9/uvFEIsRcQyRPSrQgfLtu2QbdsdlmU19fX1Pbdo0aJWt6MxUY5a9dkKANuPHz9+td/vv1nX9b8VQpQjYkBVhacsyxowTXNvKpV64dVXX92yZs2asCtSIHPcbKgk3NNr1659Zv369dcHAoGbdF1fwTkfpSelTEsp+y3LejcWi/3x3Xfffe6qq64acGKX2Ty5jxAj4saWlpb/WLJkyZd0Xb9O07RKRCxERCalTEopu9Lp9J+7u7ufWLx4sfMxgsPFxcX3q7grKgnJQqHQKy4NBOFw+BEAKFM1BsAYw1AoNOwqGspdK+bkdKtq9IXfPPYdrWzmA2DblhBMYO6AlEwAo3j8hPZWw/lvNt6XdMf6zsrtch32cm+yl156qXju3Ll506ZNg46OjszOnTuD99xzT2ScoHNODlYWDfb6668XFxQU5Hs8Huzv748//PDDJ7dv356e4JnJ8DUhvWPHjiU2bNgwmE0PJvHZFuffzz33XMGCBQumFhQUsPb29sTq1at7nDX5MDx8JCGhms3EG9egfUHtwLNGybQvgCltJljO5xoJwNJ8IKyhoWd23V98izPeOYkJnAou03iT6OojcwXjGOEoB8zj0eAq+Gx/2AogZ8OdgZ5jmkyKXm1tLaurqxv3OeW1S3dl+1jZnLq6OuejWO6NcRoimpubwfl+0Dm3KRsPjOweYWjTR+xDNulvlxEBgW2/AwAwcODcfXJOpRstVZwx5mfzXH3k2eLE9ZGr8WjYq1atss5FSZqTQj0DPal4mhQ99dU2y1Hr2Z8CzJ4n19yd1tyAdDZPdp+zAeQkYkcjmnb596OHeF7gfJmByXzBF4jA1gPA093v37L7wfOfuay2aTKhoI+v/8+unIBVUyNHxHd66GWEkS+GAEnIpRFJyQRxKxg6qA8ebQYibKmrtj+e+o+v8a7/BpoPA21yYf9XAAAAAElFTkSuQmCC" alt="SOCAR">
    <span class="logo-label">MEDIA LIST</span>
    <span class="header-count">총 <span id="total-count">0</span>명 · 출입 <span id="active-count">0</span>명</span>
  </div>
</div>

<div class="toolbar">
  <div class="search-wrap">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input class="search-input" id="searchInput" placeholder="기자명, 매체명, 이메일, 전화번호 검색..." oninput="render()">
  </div>
  <div class="filter-group" id="typeFilters"></div>
  <div class="separator"></div>
  <button class="status-btn" id="btnActive" onclick="toggleStatus('active')">● 출입</button>
  <button class="status-btn" id="btnInactive" onclick="toggleStatus('inactive')">○ 제외</button>
  <button class="add-btn" onclick="openAddModal()">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>기자 추가
  </button>
  <button class="refresh-btn" onclick="loadData()">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.59-9.21l-5.46 5.46"/></svg>새로고침
  </button>
</div>

<div class="main" id="mainContent"></div>

<div class="modal-overlay" id="editModal" style="display:none" onclick="if(event.target===this)closeEditModal()">
<div class="modal">
  <div class="modal-title" id="modalTitle">기자 추가</div>
  <div class="form-grid">
    <div class="form-field">
      <label class="form-label">매체타입</label>
      <select class="form-select" id="f-type">
        <option>종합지</option><option>경제지</option><option>통신사</option>
        <option>인터넷</option><option>IT/스타트업</option><option>방송</option><option>주간지/월간지</option><option>기타</option>
      </select>
    </div>
    <div class="form-field">
      <label class="form-label">매체명</label>
      <input class="form-input" id="f-media" list="media-datalist" placeholder="매체명">
      <datalist id="media-datalist"></datalist>
    </div>
    <div class="form-field">
      <label class="form-label">부서/담당</label>
      <input class="form-input" id="f-dept" placeholder="예: 테크부">
    </div>
    <div class="form-field">
      <label class="form-label">기자명 *</label>
      <input class="form-input" id="f-name" placeholder="홍길동 기자">
    </div>
    <div class="form-field full">
      <label class="form-label">이메일 (여러 개 추가 가능)</label>
      <div class="email-list" id="email-list"></div>
      <button class="btn-add-email" onclick="addEmailField()">+ 이메일 추가</button>
    </div>
    <div class="form-field">
      <label class="form-label">전화번호</label>
      <input class="form-input" id="f-phone" placeholder="010-0000-0000">
    </div>
    <div class="form-field">
      <label class="form-label">출입일</label>
      <input class="form-input" id="f-date" type="date">
    </div>
    <div class="form-field full">
      <label class="form-label">발송 채널</label>
      <div class="send-toggle-row">
        <button type="button" class="send-toggle" id="f-emailSend" onclick="toggleSend('f-emailSend','on-email')"><span class="dot"></span>이메일</button>
        <button type="button" class="send-toggle" id="f-smsSend" onclick="toggleSend('f-smsSend','on-sms')"><span class="dot"></span>문자</button>
      </div>
    </div>
    <div class="form-field full">
      <label class="form-label">메모</label>
      <textarea class="form-textarea" id="f-memo" placeholder="담당 분야, 특이사항 등..."></textarea>
    </div>
  </div>
  <div class="modal-actions">
    <button class="btn-cancel" onclick="closeEditModal()">취소</button>
    <button class="btn-save" onclick="saveJournalist()">저장</button>
  </div>
</div>
</div>

<div class="modal-overlay" id="histModal" style="display:none" onclick="if(event.target===this)closeHistModal(true)">
<div class="modal" style="max-width:460px">
  <div class="modal-title" id="histModalTitle">출입 이력</div>
  <div class="hist-modal-entries" id="histEntries"></div>
  <div class="add-hist-row">
    <select id="h-type"><option value="join">출입</option><option value="leave">제외</option></select>
    <input type="date" id="h-date">
    <input type="text" id="h-note" placeholder="메모" style="flex:1">
    <button class="btn-add-hist" onclick="addHistEntry()">추가</button>
  </div>
  <div class="modal-actions">
    <button class="btn-save" onclick="closeHistModal(true)">완료</button>
  </div>
</div>
</div>

<div id="loadingOverlay" class="loading-overlay" style="display:none;">
  <div class="spinner"></div>
  <div id="loadingText">데이터를 불러오는 중입니다...</div>
</div>

<div class="toast" id="toast"></div>

<script>
// ★ 방금 발급받은 URL을 여기에 넣습니다.
const API_URL = "https://script.google.com/macros/s/AKfycbxtB2oTkcWboVkgBDByDqRbXxPVWaVGyuVx3L4acxlhCDpPRP8PwzZJpdUNn_Bmpyk4-w/exec";

let data = [];
let nextId = 1;

const MEDIA_TYPES = ["종합지","경제지","통신사","인터넷","IT/스타트업","방송","주간지/월간지","기타"];
let typeFilter = null;
let statusFilter = active;
let editingId = null;
let histEditingId = null;

// ── 데이터 로딩 ─────────────────────────────────────
function showLoading(msg = '로딩 중...') {
  document.getElementById('loadingText').textContent = msg;
  document.getElementById('loadingOverlay').style.display = 'flex';
}
function hideLoading() {
  document.getElementById('loadingOverlay').style.display = 'none';
}

async function loadData() {
  showLoading('구글 시트에서 최신 데이터를 불러오는 중입니다...');
  try {
    const res = await fetch(API_URL);
    data = await res.json();
    if (data.length > 0) {
      nextId = Math.max(...data.map(d => parseInt(d.id) || 0)) + 1;
    }
    initFilters();
    render();
  } catch (error) {
    alert('데이터를 불러오지 못했습니다. 네트워크 상태를 확인해주세요.');
  } finally {
    hideLoading();
  }
}

// ── FILTER ─────────────────────────────────────────
function getFiltered() {
  const q = document.getElementById('searchInput').value.trim().toLowerCase();
  return data.filter(j => {
    if (typeFilter && j.mediaType !== typeFilter) return false;
    if (statusFilter === 'active' && !j.active) return false;
    if (statusFilter === 'inactive' && j.active) return false;
    if (!q) return true;
    return (j.name||'').toLowerCase().includes(q) ||
      (j.mediaName||'').toLowerCase().includes(q) ||
      (j.dept||'').toLowerCase().includes(q) ||
      (j.emails||[]).some(e=>e.toLowerCase().includes(q)) ||
      (j.phone||'').includes(q) ||
      (j.memo||'').toLowerCase().includes(q);
  });
}

// ── RENDER ─────────────────────────────────────────
function render() {
  const filtered = getFiltered();
  document.getElementById('total-count').textContent = data.length;
  document.getElementById('active-count').textContent = data.filter(d=>d.active).length;

  const main = document.getElementById('mainContent');
  if (!filtered.length) { main.innerHTML = '<div class="no-results">검색 결과가 없습니다.</div>'; return; }

  const groupMap = new Map();
  filtered.forEach(j => {
    const key = j.sheetOrder + '||'  + j.mediaOrder + '||' + j.mediaType + '||' + j.mediaName;
    if (!groupMap.has(key)) groupMap.set(key, {sheetOrder:j.sheetOrder, mediaOrder:j.mediaOrder, mediaType:j.mediaType, mediaName:j.mediaName, list:[]});
    groupMap.get(key).list.push(j);
  });

  const groups = [...groupMap.values()].sort((a,b) => a.sheetOrder !== b.sheetOrder ? a.sheetOrder - b.sheetOrder : a.mediaOrder - b.mediaOrder);

  let html = '';
  groups.forEach(g => {
    const active = g.list.filter(j=>j.active);
    const inactive = g.list.filter(j=>!j.active);
    const sorted = [...active, ...inactive];

    const activeCount = active.length;
    const totalCount = sorted.length;
    const tagClass = 'tag-' + g.mediaType.replace('/','/');
    const gKey = encodeURIComponent(g.sheetOrder+'_'+g.mediaOrder+'_'+g.mediaName);

    html += `<div class="media-group">
      <div class="media-header" onclick="toggleGroup('${gKey}')">
        <span class="media-type-tag ${tagClass}">${g.mediaType}</span>
        <span class="media-name">${g.mediaName}</span>
        <span class="media-count">${activeCount}/${totalCount}명</span>
        <span class="chevron open" id="chev-${gKey}">▾</span>
      </div>
      <div class="table-wrap" id="grp-${gKey}">
        <table>
          <colgroup>
            <col class="col-dept"><col class="col-name"><col class="col-email">
            <col class="col-phone"><col class="col-send"><col class="col-history">
            <col class="col-memo"><col class="col-status"><col class="col-actions">
          </colgroup>
          <thead><tr>
            <th>부서/담당</th><th>기자명</th><th>이메일</th><th>전화번호</th>
            <th>발송</th><th>출입 이력</th><th>메모</th><th>상태</th><th></th>
          </tr></thead>
          <tbody>`;

    sorted.forEach(j => {
      const iClass = j.active ? '' : 'row-inactive';

      const emailsHtml = (j.emails||[]).length
        ? (j.emails||[]).map(e => `<span class="email-tag" onclick="copyText('${e.replace(/'/g,"\'")}',this)">${e}</span>`).join('')
        : '<span style="color:var(--text3);font-size:12px">—</span>';

      const ef = j.emailSend ? '<span class="send-flag flag-email-on">✉ 이메일</span>' : '';
      const sf = j.smsSend ? '<span class="send-flag flag-sms-on">✆ 문자</span>' : '';
      const sendHtml = (ef||sf) ? `<div class="send-flags">${ef}${sf}</div>` : '<span style="color:var(--text3);font-size:12px">—</span>';

      const last2 = (j.history||[]).slice(-2);
      const histHtml = `<div class="hist-wrap">
        ${last2.map(h=>`<span class="hist-pill ${h.type==='join'?'hist-join':'hist-leave'}">${h.type==='join'?'↑':'↓'} ${h.date}</span>`).join('')}
        ${(j.history||[]).length>2?`<span style="font-size:10px;color:var(--text3)">+${(j.history||[]).length-2}</span>`:''}
        <button class="icon-btn" onclick="openHistModal(${j.id})" title="이력" style="width:22px;height:22px;font-size:10px">≡</button>
      </div>`;

      const statusHtml = `<span class="status-badge ${j.active?'badge-active':'badge-inactive'}" onclick="toggleActive(${j.id})">${j.active?'● 출입':'○ 제외'}</span>`;

      html += `<tr class="${iClass}">
        <td class="td-dept">${j.dept||''}</td>
        <td class="td-name">${j.name}</td>
        <td><div class="email-cell">${emailsHtml}</div></td>
        <td>${j.phone ? `<span class="phone-tag" onclick="copyText('${j.phone}',this)">${j.phone}</span>` : '<span style="color:var(--text3);font-size:12px">—</span>'}</td>
        <td>${sendHtml}</td>
        <td>${histHtml}</td>
        <td style="font-size:12px;color:var(--text2)">${j.memo||''}</td>
        <td>${statusHtml}</td>
        <td><div class="row-actions">
          <button class="icon-btn" onclick="copyRow(${j.id})" title="복사">⎘</button>
          <button class="icon-btn" onclick="openEditModal(${j.id})" title="편집">✎</button>
        </div></td>
      </tr>`;
    });
    html += '</tbody></table></div></div>';
  });
  main.innerHTML = html;
}

// ── TOGGLE GROUP ────────────────────────────────────
function toggleGroup(key) {
  const el = document.getElementById('grp-'+key);
  const ch = document.getElementById('chev-'+key);
  if (!el) return;
  el.classList.toggle('collapsed');
  ch.classList.toggle('open');
}

// ── 구글 시트 전송 공통 함수 ───────────────────────────
async function saveToGoogleSheet(action, item) {
  try {
    await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify({ action: action, data: item })
    });
  } catch (e) {
    console.error(e);
    alert('저장 중 서버 통신 에러가 발생했습니다.');
  }
}

// ── TOGGLE ACTIVE ───────────────────────────────────
async function toggleActive(id) {
  const j = data.find(d=>d.id===id);
  if (!j) return;
  
  showLoading('상태를 변경하고 저장 중입니다...');
  
  j.active = !j.active;
  const today = new Date().toISOString().slice(0,10);
  j.history = j.history || [];
  j.history.push({type: j.active ? 'join' : 'leave', date: today, note: j.active ? '출입 복귀' : '제외 처리'});
  
  await saveToGoogleSheet('edit', j);
  
  render();
  hideLoading();
  showToast(j.active ? `${j.name} 출입 복귀` : `${j.name} 제외 처리됨`);
}

// ── COPY ────────────────────────────────────────────
function copyText(text, el) {
  navigator.clipboard.writeText(text).then(() => {
    const orig = el.textContent;
    el.classList.add('copied');
    el.textContent = '복사됨';
    setTimeout(() => { el.classList.remove('copied'); el.textContent = orig; }, 1400);
  });
}
function copyRow(id) {
  const j = data.find(d=>d.id===id);
  if (!j) return;
  const text = j.name + '\t' + (j.emails||[]).join(', ') + '\t' + j.phone;
  navigator.clipboard.writeText(text).then(() => showToast(`${j.name} 정보 복사됨`));
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2400);
}

// ── TYPE FILTERS ─────────────────────────────────────
function initFilters() {
  const wrap = document.getElementById('typeFilters');
  let h = '<button class="filter-btn active" id="tf-all" onclick="setTypeFilter(null)">전체</button>';
  MEDIA_TYPES.forEach(t => h += `<button class="filter-btn" id="tf-${t}" onclick="setTypeFilter('${t}')">${t}</button>`);
  wrap.innerHTML = h;
}
function setTypeFilter(t) {
  typeFilter = t;
  document.querySelectorAll('#typeFilters .filter-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(t ? `tf-${t}` : 'tf-all').classList.add('active');
  render();
}
function toggleStatus(s) {
  statusFilter = statusFilter === s ? null : s;
  document.getElementById('btnActive').className = 'status-btn' + (statusFilter==='active'?' active-filter':'');
  document.getElementById('btnInactive').className = 'status-btn' + (statusFilter==='inactive'?' inactive-filter':'');
  render();
}

// ── EMAIL FIELDS ─────────────────────────────────────
function renderEmailFields(emails) {
  const list = document.getElementById('email-list');
  list.innerHTML = '';
  (emails.length ? emails : ['']).forEach((e) => {
    const row = document.createElement('div');
    row.className = 'email-row';
    row.innerHTML = `<input class="form-input" placeholder="email@media.com" value="${e}"><button class="btn-remove-email" onclick="removeEmailField(this)">✕</button>`;
    list.appendChild(row);
  });
}
function addEmailField() {
  const list = document.getElementById('email-list');
  const row = document.createElement('div');
  row.className = 'email-row';
  row.innerHTML = '<input class="form-input" placeholder="email@media.com"><button class="btn-remove-email" onclick="removeEmailField(this)">✕</button>';
  list.appendChild(row);
}
function removeEmailField(btn) {
  const list = document.getElementById('email-list');
  if (list.children.length > 1) btn.parentElement.remove();
  else btn.previousElementSibling.value = '';
}
function getEmailValues() {
  return [...document.querySelectorAll('#email-list .email-row input')].map(i=>i.value.trim()).filter(v=>v && v.includes('@'));
}

// ── EDIT MODAL ───────────────────────────────────────
function updateMediaDatalist() {
  const names = [...new Set(data.map(d=>d.mediaName))].sort((a,b)=>a.localeCompare(b,'ko'));
  document.getElementById('media-datalist').innerHTML = names.map(n=>`<option value="${n}">`).join('');
}
function openAddModal() {
  editingId = null;
  document.getElementById('modalTitle').textContent = '기자 추가';
  document.getElementById('f-type').value = '종합지';
  document.getElementById('f-media').value = '';
  document.getElementById('f-dept').value = '';
  document.getElementById('f-name').value = '';
  document.getElementById('f-phone').value = '';
  document.getElementById('f-date').value = new Date().toISOString().slice(0,10);
  setSendVal('f-emailSend', false, 'on-email');
  setSendVal('f-smsSend', false, 'on-sms');
  document.getElementById('f-memo').value = '';
  renderEmailFields([]);
  updateMediaDatalist();
  document.getElementById('editModal').style.display = 'flex';
}
function openEditModal(id) {
  editingId = id;
  const j = data.find(d=>d.id===id);
  if (!j) return;
  document.getElementById('modalTitle').textContent = '기자 정보 편집';
  document.getElementById('f-type').value = j.mediaType;
  document.getElementById('f-media').value = j.mediaName;
  document.getElementById('f-dept').value = j.dept;
  document.getElementById('f-name').value = j.name;
  document.getElementById('f-phone').value = j.phone;
  document.getElementById('f-date').value = '';
  setSendVal('f-emailSend', j.emailSend, 'on-email');
  setSendVal('f-smsSend', j.smsSend, 'on-sms');
  document.getElementById('f-memo').value = j.memo||'';
  renderEmailFields(j.emails||[]);
  updateMediaDatalist();
  document.getElementById('editModal').style.display = 'flex';
}
function closeEditModal() { document.getElementById('editModal').style.display = 'none'; }

async function saveJournalist() {
  const name = document.getElementById('f-name').value.trim();
  if (!name) { alert('기자명을 입력하세요.'); return; }
  
  showLoading('데이터를 구글 시트에 저장하는 중입니다...');
  
  const emails = getEmailValues();
  let targetData = null;
  let actionStr = 'add';

  if (editingId) {
    actionStr = 'edit';
    targetData = data.find(d=>d.id===editingId);
    targetData.mediaType = document.getElementById('f-type').value;
    targetData.mediaName = document.getElementById('f-media').value.trim();
    targetData.dept = document.getElementById('f-dept').value.trim();
    targetData.name = name; targetData.emails = emails;
    targetData.phone = document.getElementById('f-phone').value.trim();
    targetData.emailSend = getSendVal('f-emailSend');
    targetData.smsSend = getSendVal('f-smsSend');
    targetData.memo = document.getElementById('f-memo').value.trim();
  } else {
    const date = document.getElementById('f-date').value;
    targetData = {
      id: nextId++, sheet: '신규', sheetOrder: 99, mediaOrder: 9999,
      mediaType: document.getElementById('f-type').value,
      mediaName: document.getElementById('f-media').value.trim(),
      dept: document.getElementById('f-dept').value.trim(),
      name, emails, phone: document.getElementById('f-phone').value.trim(),
      active: true,
      emailSend: getSendVal('f-emailSend'),
      smsSend: getSendVal('f-smsSend'),
      memo: document.getElementById('f-memo').value.trim(),
      date, history: date ? [{type:'join', date, note:'최초 등록'}] : []
    };
    data.push(targetData);
  }

  await saveToGoogleSheet(actionStr, targetData);

  closeEditModal(); 
  render();
  hideLoading();
  showToast(editingId ? `${name} 정보 업데이트됨` : `${name} 추가됨`);
}

// ── HISTORY MODAL ────────────────────────────────────
function openHistModal(id) {
  histEditingId = id;
  const j = data.find(d=>d.id===id);
  if (!j) return;
  document.getElementById('histModalTitle').textContent = `${j.name} · 출입 이력`;
  document.getElementById('h-date').value = new Date().toISOString().slice(0,10);
  document.getElementById('h-note').value = '';
  renderHistEntries(j);
  document.getElementById('histModal').style.display = 'flex';
}
function renderHistEntries(j) {
  const wrap = document.getElementById('histEntries');
  if (!(j.history||[]).length) { wrap.innerHTML = '<div style="color:var(--text3);text-align:center;padding:16px;font-size:13px">이력 없음</div>'; return; }
  wrap.innerHTML = (j.history||[]).map((h,i) => `
    <div class="hist-modal-entry">
      <span class="hist-dot ${h.type==='join'?'dot-join':'dot-leave'}"></span>
      <span class="hist-date">${h.date}</span>
      <span class="hist-type-label ${h.type==='join'?'type-join':'type-leave'}">${h.type==='join'?'출입':'제외'}</span>
      <span class="hist-note">${h.note||''}</span>
      <button class="icon-btn" onclick="removeHist(${i})" style="width:22px;height:22px;font-size:10px;margin-left:auto">✕</button>
    </div>`).join('');
}
async function removeHist(idx) {
  const j = data.find(d=>d.id===histEditingId); if (!j) return;
  
  showLoading('이력을 삭제하고 구글 시트에 반영 중입니다...');
  
  j.history.splice(idx,1); 
  await saveToGoogleSheet('edit', j);
  
  renderHistEntries(j);
  render();
  hideLoading();
}
async function addHistEntry() {
  const j = data.find(d=>d.id===histEditingId); if (!j) return;
  const type = document.getElementById('h-type').value;
  const date = document.getElementById('h-date').value;
  if (!date) { alert('날짜를 입력하세요.'); return; }
  const note = document.getElementById('h-note').value.trim();
  
  showLoading('새 이력을 추가하고 구글 시트에 반영 중입니다...');
  
  j.history = j.history || [];
  j.history.push({type, date, note});
  j.history.sort((a,b)=>a.date.localeCompare(b.date));
  const last = j.history[j.history.length-1];
  j.active = last.type === 'join';
  document.getElementById('h-note').value = '';
  
  await saveToGoogleSheet('edit', j);
  
  renderHistEntries(j);
  render();
  hideLoading();
  showToast('이력 추가됨');
}
function closeHistModal(doRender) {
  document.getElementById('histModal').style.display = 'none';
  if (doRender) render();
}

function toggleSend(id, cls) {
  document.getElementById(id).classList.toggle(cls);
}
function getSendVal(id) {
  const btn = document.getElementById(id);
  return btn.classList.contains('on-email') || btn.classList.contains('on-sms');
}
function setSendVal(id, val, cls) {
  document.getElementById(id).classList.toggle(cls, !!val);
}

// ── 초기화 실행 ─────────────────────────────────────
// 화면 렌더링을 멈추고 서버에서 데이터를 먼저 불러옵니다.
loadData();
</script>
</body>
</html>


